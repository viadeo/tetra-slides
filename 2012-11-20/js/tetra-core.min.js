/*! Tetra.js v1.0.1 | (MIT Licence) (c) Viadeo/APVO Corp */
var tns={},tetra=function(){var e={env:"jQuery",enableBootnode:!1,bootnodeEvents:["click","mouseover","focus"],APPS_PATH:"/javascript/tetramvc/apps",GLOBAL_PATH:"/javascript/tetramvc",COMP_PATH:"/resource/comp",FETCH_URL:"/javascript/tetramvc/model/{name}/fetch.json",FETCH_METHOD:"GET",SAVE_URL:"/javascript/tetramvc/model/{name}/save.json",SAVE_METHOD:"POST",DEL_URL:"/javascript/tetramvc/model/{name}/delete.json",DEL_METHOD:"DELETE",RESET_URL:"/javascript/tetramvc/model/{name}/reset.json",RESET_METHOD:"PUT"},t,n=!1,r={},i={},s={},o=function(e,t){t?s.debug.log("module "+e+" : function "+t+" not implemented","all","error"):s.debug.log("module "+e+" not implemented","all","error")};return s.lib=t=typeof $!="undefined"?$:null,s.dep={define:function(){o("dep","define")},undef:function(){o("dep","undef")},require:function(){o("dep","require")}},s.orm=function(){return o("orm"),{type:"interface",save:function(){o("orm","save")},fetch:function(){o("orm","fetch")},del:function(){o("orm","del")},reset:function(){o("orm","reset")},notify:function(){o("orm","notify")}}},s.pipe={page:{notify:function(e,t){return s.debug.log("page : "+e,"all","log",t),tetra.controller.notify(e,t),this}},appBuilder:function(e,t){return e==="view"?{notify:function(n,r){return s.debug.log("app "+t+" : "+e+" : "+n,t,"log",r),tetra.view.notify(n,r,t),this}}:{notify:function(n,r){return s.debug.log("app "+t+" : "+e+" : "+n,t,"log",r),tetra.controller.notify(n,r,t),this},exec:function(){var e=[],n=0,r=arguments.length;for(;n<r;n++)e.push(arguments[n]);return e.push(t),tetra.controller.exec.apply(this,e)}}}},i.view={register:function(){o("view","register")},destroy:function(){o("view","destroy")},notify:function(){o("view","notify")},debug:{}},i.controller={register:function(){o("controller","register")},destroy:function(){o("controller","destroy")},notify:function(){o("controller","notify")},modelNotify:function(){o("controller","modelNotify")},exec:function(){o("controller","exec")},debug:{}},i.model={register:function(){o("model","register")},destroy:function(){o("model","destroy")},debug:{}},i.debug=function(){var e={},n=function(t,n,r,i){n=n||"all";if(typeof window.console!="undefined"&&(e[n]||n!=="all"&&e.all)){i=i||"",r=r||"log";try{console[r](t,i)}catch(s){}}};return s.debug={log:function(){}},{enable:function(r){r=r||"all",e[r]=!0,window._=t,s.debug={log:n},i.debug={enable:this.enable,man:function(){return n("Tetra.js ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"),n("> debug enabled"),n("> man specs > tetra.debug.man()"),n("	# View specs			> tetra.debug.view.man()"),n("	# Controller specs		> tetra.debug.controller.man()"),n("	# Model specs			> tetra.debug.model.man()"),n("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"),!0},view:i.view.debug,ctrl:i.controller.debug,model:i.model.debug}}}}(),i.extend=function(){var o=function(t,i){if(t==="conf")for(var o in i)e[o]=i[o];else n?u(t,i):(r[t]=i,s.debug.log('Module "'+t+'" defined'))},u=function(n,r){typeof i[n]!="undefined"?(i[n]=r(e,s,t),s.debug.log('Tetra module "'+n+'" loaded')):(n==="lib"?s[n]=t=r(e,s,t):s[n]=r(e,s,t),s.debug.log('Extension module "'+n+'" loaded'))},a=function(){if(typeof arguments[0]!="undefined")if(typeof arguments[0]=="string")o(arguments[0],arguments[1]);else for(var e in arguments[0])o(e,arguments[0][e]);return i},f=function(){n=!0;for(var e in r)u(e,r[e]);r=[]};return i.start=f,a}(),i}();typeof module!="undefined"&&typeof module.exports!="undefined"&&(exports=module.exports={},exports.tns=tns,exports.tetra=tetra);var requirejs,require,define;(function(global){function isFunction(e){return ostring.call(e)==="[object Function]"}function isArray(e){return ostring.call(e)==="[object Array]"}function each(e,t){if(e){var n;for(n=0;n<e.length;n+=1)if(e[n]&&t(e[n],n,e))break}}function eachReverse(e,t){if(e){var n;for(n=e.length-1;n>-1;n-=1)if(e[n]&&t(e[n],n,e))break}}function hasProp(e,t){return hasOwn.call(e,t)}function eachProp(e,t){var n;for(n in e)if(e.hasOwnProperty(n)&&t(e[n],n))break}function mixin(e,t,n,r){return t&&eachProp(t,function(t,i){if(n||!hasProp(e,i))r&&typeof t!="string"?(e[i]||(e[i]={}),mixin(e[i],t,n,r)):e[i]=t}),e}function bind(e,t){return function(){return t.apply(e,arguments)}}function scripts(){return document.getElementsByTagName("script")}function getGlobal(e){if(!e)return e;var t=global;return each(e.split("."),function(e){t=t[e]}),t}function makeContextModuleFunc(e,t,n){return function(){var r=aps.call(arguments,0),i;return n&&isFunction(i=r[r.length-1])&&(i.__requireJsBuild=!0),r.push(t),e.apply(null,r)}}function addRequireMethods(e,t,n){each([["toUrl"],["undef"],["defined","requireDefined"],["specified","requireSpecified"]],function(r){var i=r[1]||r[0];e[r[0]]=t?makeContextModuleFunc(t[i],n):function(){var e=contexts[defContextName];return e[i].apply(e,arguments)}})}function makeError(e,t,n,r){var i=new Error(t+"\nhttp://requirejs.org/docs/errors.html#"+e);return i.requireType=e,i.requireModules=r,n&&(i.originalError=n),i}function newContext(e){function v(e){var t,n;for(t=0;e[t];t+=1){n=e[t];if(n===".")e.splice(t,1),t-=1;else if(n===".."){if(t===1&&(e[2]===".."||e[0]===".."))break;t>0&&(e.splice(t-1,2),t-=2)}}}function m(e,t,n){var r,i,s,u,a,f,l,c,h,p,d,m=t&&t.split("/"),g=m,y=o.map,b=y&&y["*"];e&&e.charAt(0)==="."&&(t?(o.pkgs[t]?g=m=[t]:g=m.slice(0,m.length-1),e=g.concat(e.split("/")),v(e),i=o.pkgs[r=e[0]],e=e.join("/"),i&&e===r+"/"+i.main&&(e=r)):e.indexOf("./")===0&&(e=e.substring(2)));if(n&&(m||b)&&y){u=e.split("/");for(a=u.length;a>0;a-=1){l=u.slice(0,a).join("/");if(m)for(f=m.length;f>0;f-=1){s=y[m.slice(0,f).join("/")];if(s){s=s[l];if(s){c=s,h=a;break}}}if(c)break;!p&&b&&b[l]&&(p=b[l],d=a)}!c&&p&&(c=p,h=d),c&&(u.splice(0,h,c),e=u.join("/"))}return e}function g(e){isBrowser&&each(scripts(),function(t){if(t.getAttribute("data-requiremodule")===e&&t.getAttribute("data-requirecontext")===r.contextName)return t.parentNode.removeChild(t),!0})}function y(e){var t=o.paths[e];if(t&&isArray(t)&&t.length>1)return g(e),t.shift(),r.undef(e),r.require([e]),!0}function b(e,t,n,i){var s,o,u,a=e?e.indexOf("!"):-1,f=null,c=t?t.name:null,d=e,v=!0,g="";return e||(v=!1,e="_@r"+(h+=1)),a!==-1&&(f=e.substring(0,a),e=e.substring(a+1,e.length)),f&&(f=m(f,c,i),o=l[f]),e&&(f?o&&o.normalize?g=o.normalize(e,function(e){return m(e,c,i)}):g=m(e,c,i):(g=m(e,c,i),s=r.nameToUrl(g))),u=f&&!o&&!n?"_unnormalized"+(p+=1):"",{prefix:f,name:g,parentMap:t,unnormalized:!!u,url:s,originalName:d,isDefine:v,id:(f?f+"!"+g:g)+u}}function w(e){var t=e.id,n=u[t];return n||(n=u[t]=new r.Module(e)),n}function E(e,t,n){var r=e.id,i=u[r];hasProp(l,r)&&(!i||i.defineEmitComplete)?t==="defined"&&n(l[r]):w(e).on(t,n)}function S(e,t){var n=e.requireModules,r=!1;t?t(e):(each(n,function(t){var n=u[t];n&&(n.error=e,n.events.error&&(r=!0,n.emit("error",e)))}),r||req.onError(e))}function x(){globalDefQueue.length&&(apsp.apply(f,[f.length-1,0].concat(globalDefQueue)),globalDefQueue=[])}function T(e,t,n){var i=e&&e.map,s=makeContextModuleFunc(n||r.require,i,t);return addRequireMethods(s,r,i),s.isBrowser=isBrowser,s}function N(e){delete u[e],each(d,function(t,n){if(t.map.id===e)return d.splice(n,1),t.defined||(r.waitCount-=1),!0})}function C(e,t,n){var r=e.map.id,i=e.depMaps,s;if(!e.inited)return;return t[r]?e:(t[r]=!0,each(i,function(e){var r=e.id,i=u[r];if(!i||n[r]||!i.inited||!i.enabled)return;return s=C(i,t,n)}),n[r]=!0,s)}function k(e,t,n){var r=e.map.id,s=e.depMaps;if(!e.inited||!e.map.isDefine)return;return t[r]?l[r]:(t[r]=e,each(s,function(s){var o=s.id,a=u[o],f;if(i[o])return;if(a){if(!a.inited||!a.enabled){n[r]=!0;return}f=k(a,t,n),n[o]||e.defineDepById(o,f)}}),e.check(!0),l[r])}function L(e){e.check()}function A(){var e,n,i,a,f=o.waitSeconds*1e3,l=f&&r.startTime+f<(new Date).getTime(),c=[],h=!1,p=!0;if(t)return;t=!0,eachProp(u,function(t){e=t.map,n=e.id;if(!t.enabled)return;if(!t.error)if(!t.inited&&l)y(n)?(a=!0,h=!0):(c.push(n),g(n));else if(!t.inited&&t.fetched&&e.isDefine){h=!0;if(!e.prefix)return p=!1}});if(l&&c.length)return i=makeError("timeout","Load timeout for modules: "+c,null,c),i.contextName=r.contextName,S(i);p&&(each(d,function(e){if(e.defined)return;var t=C(e,{},{}),n={};t&&(k(t,n,{}),eachProp(n,L))}),eachProp(u,L)),(!l||a)&&h&&(isBrowser||isWebWorker)&&!s&&(s=setTimeout(function(){s=0,A()},50)),t=!1}function O(e){w(b(e[0],null,!0)).init(e[1],e[2])}function M(e,t,n,r){e.detachEvent&&!isOpera?r&&e.detachEvent(r,t):e.removeEventListener(n,t,!1)}function _(e){var t=e.currentTarget||e.srcElement;return M(t,r.onScriptLoad,"load","onreadystatechange"),M(t,r.onScriptError,"error"),{node:t,id:t&&t.getAttribute("data-requiremodule")}}var t,n,r,i,s,o={waitSeconds:7,baseUrl:"./",paths:{},pkgs:{},shim:{}},u={},a={},f=[],l={},c={},h=1,p=1,d=[];return i={require:function(e){return T(e)},exports:function(e){e.usingExports=!0;if(e.map.isDefine)return e.exports=l[e.map.id]={}},module:function(e){return e.module={id:e.map.id,uri:e.map.url,config:function(){return o.config&&o.config[e.map.id]||{}},exports:l[e.map.id]}}},n=function(e){this.events=a[e.id]||{},this.map=e,this.shim=o.shim[e.id],this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},n.prototype={init:function(e,t,n,r){r=r||{};if(this.inited)return;this.factory=t,n?this.on("error",n):this.events.error&&(n=bind(this,function(e){this.emit("error",e)})),this.depMaps=e&&e.slice(0),this.depMaps.rjsSkipMap=e.rjsSkipMap,this.errback=n,this.inited=!0,this.ignore=r.ignore,r.enabled||this.enabled?this.enable():this.check()},defineDepById:function(e,t){var n;return each(this.depMaps,function(t,r){if(t.id===e)return n=r,!0}),this.defineDep(n,t)},defineDep:function(e,t){this.depMatched[e]||(this.depMatched[e]=!0,this.depCount-=1,this.depExports[e]=t)},fetch:function(){if(this.fetched)return;this.fetched=!0,r.startTime=(new Date).getTime();var e=this.map;if(!this.shim)return e.prefix?this.callPlugin():this.load();T(this,!0)(this.shim.deps||[],bind(this,function(){return e.prefix?this.callPlugin():this.load()}))},load:function(){var e=this.map.url;c[e]||(c[e]=!0,r.load(this.map.id,e))},check:function(e){if(!this.enabled||this.enabling)return;var t,n,i=this.map.id,s=this.depExports,o=this.exports,a=this.factory;if(!this.inited)this.fetch();else if(this.error)this.emit("error",this.error);else if(!this.defining){this.defining=!0;if(this.depCount<1&&!this.defined){if(isFunction(a)){if(this.events.error)try{o=r.execCb(i,a,s,o)}catch(f){t=f}else o=r.execCb(i,a,s,o);this.map.isDefine&&(n=this.module,n&&n.exports!==undefined&&n.exports!==this.exports?o=n.exports:o===undefined&&this.usingExports&&(o=this.exports));if(t)return t.requireMap=this.map,t.requireModules=[this.map.id],t.requireType="define",S(this.error=t)}else o=a;this.exports=o,this.map.isDefine&&!this.ignore&&(l[i]=o,req.onResourceLoad&&req.onResourceLoad(r,this.map,this.depMaps)),delete u[i],this.defined=!0,r.waitCount-=1,r.waitCount===0&&(d=[])}this.defining=!1,e||this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}},callPlugin:function(){var e=this.map,t=e.id,n=b(e.prefix,null,!1,!0);E(n,"defined",bind(this,function(n){var i,s,a,f=this.map.name,l=this.map.parentMap?this.map.parentMap.name:null;if(this.map.unnormalized){n.normalize&&(f=n.normalize(f,function(e){return m(e,l,!0)})||""),s=b(e.prefix+"!"+f,this.map.parentMap,!1,!0),E(s,"defined",bind(this,function(e){this.init([],function(){return e},null,{enabled:!0,ignore:!0})})),a=u[s.id],a&&(this.events.error&&a.on("error",bind(this,function(e){this.emit("error",e)})),a.enable());return}i=bind(this,function(e){this.init([],function(){return e},null,{enabled:!0})}),i.error=bind(this,function(e){this.inited=!0,this.error=e,e.requireModules=[t],eachProp(u,function(e){e.map.id.indexOf(t+"_unnormalized")===0&&N(e.map.id)}),S(e)}),i.fromText=function(e,t){var n=useInteractive;n&&(useInteractive=!1),w(b(e)),req.exec(t),n&&(useInteractive=!0),r.completeLoad(e)},n.load(e.name,T(e.parentMap,!0,function(e,t,n){return e.rjsSkipMap=!0,r.require(e,t,n)}),i,o)})),r.enable(n,this),this.pluginMaps[n.id]=n},enable:function(){this.enabled=!0,this.waitPushed||(d.push(this),r.waitCount+=1,this.waitPushed=!0),this.enabling=!0,each(this.depMaps,bind(this,function(e,t){var n,s,o;if(typeof e=="string"){e=b(e,this.map.isDefine?this.map:this.map.parentMap,!1,!this.depMaps.rjsSkipMap),this.depMaps[t]=e,o=i[e.id];if(o){this.depExports[t]=o(this);return}this.depCount+=1,E(e,"defined",bind(this,function(e){this.defineDep(t,e),this.check()})),this.errback&&E(e,"error",this.errback)}n=e.id,s=u[n],!i[n]&&s&&!s.enabled&&r.enable(e,this)})),eachProp(this.pluginMaps,bind(this,function(e){var t=u[e.id];t&&!t.enabled&&r.enable(e,this)})),this.enabling=!1,this.check()},on:function(e,t){var n=this.events[e];n||(n=this.events[e]=[]),n.push(t)},emit:function(e,t){each(this.events[e],function(e){e(t)}),e==="error"&&delete this.events[e]}},r={config:o,contextName:e,registry:u,defined:l,urlFetched:c,waitCount:0,defQueue:f,Module:n,makeModuleMap:b,configure:function(e){e.baseUrl&&e.baseUrl.charAt(e.baseUrl.length-1)!=="/"&&(e.baseUrl+="/");var t=o.pkgs,n=o.shim,i=o.paths,s=o.map;mixin(o,e,!0),o.paths=mixin(i,e.paths,!0),e.map&&(o.map=mixin(s||{},e.map,!0,!0)),e.shim&&(eachProp(e.shim,function(e,t){isArray(e)&&(e={deps:e}),e.exports&&!e.exports.__buildReady&&(e.exports=r.makeShimExports(e.exports)),n[t]=e}),o.shim=n),e.packages&&(each(e.packages,function(e){var n;e=typeof e=="string"?{name:e}:e,n=e.location,t[e.name]={name:e.name,location:n||e.name,main:(e.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}}),o.pkgs=t),eachProp(u,function(e,t){!e.inited&&!e.map.unnormalized&&(e.map=b(t))}),(e.deps||e.callback)&&r.require(e.deps||[],e.callback)},makeShimExports:function(e){var t;return typeof e=="string"?(t=function(){return getGlobal(e)},t.exports=e,t):function(){return e.apply(global,arguments)}},requireDefined:function(e,t){return hasProp(l,b(e,t,!1,!0).id)},requireSpecified:function(e,t){return e=b(e,t,!1,!0).id,hasProp(l,e)||hasProp(u,e)},require:function(t,n,i,s){var o,u,a,c,h;if(typeof t=="string")return isFunction(n)?S(makeError("requireargs","Invalid require call"),i):req.get?req.get(r,t,n):(o=t,s=n,a=b(o,s,!1,!0),u=a.id,hasProp(l,u)?l[u]:S(makeError("notloaded",'Module name "'+u+'" has not been loaded yet for context: '+e)));i&&!isFunction(i)&&(s=i,i=undefined),n&&!isFunction(n)&&(s=n,n=undefined),x();while(f.length){h=f.shift();if(h[0]===null)return S(makeError("mismatch","Mismatched anonymous define() module: "+h[h.length-1]));O(h)}return c=w(b(null,s)),c.init(t,n,i,{enabled:!0}),A(),r.require},undef:function(e){x();var t=b(e,null,!0),n=u[e];delete l[e],delete c[t.url],delete a[e],n&&(n.events.defined&&(a[e]=n.events),N(e))},enable:function(e,t){var n=u[e.id];n&&w(e).enable()},completeLoad:function(e){var t,n,r,i=o.shim[e]||{},s=i.exports&&i.exports.exports;x();while(f.length){n=f.shift();if(n[0]===null){n[0]=e;if(t)break;t=!0}else n[0]===e&&(t=!0);O(n)}r=u[e];if(!t&&!l[e]&&r&&!r.inited){if(o.enforceDefine&&(!s||!getGlobal(s))){if(y(e))return;return S(makeError("nodefine","No define call for "+e,null,[e]))}O([e,i.deps||[],i.exports])}A()},toUrl:function(e,t){var n=e.lastIndexOf("."),i=null;return n!==-1&&(i=e.substring(n,e.length),e=e.substring(0,n)),r.nameToUrl(m(e,t&&t.id,!0),i)},nameToUrl:function(e,t){var n,r,i,s,u,a,f,l,c;if(req.jsExtRegExp.test(e))l=e+(t||"");else{n=o.paths,r=o.pkgs,u=e.split("/");for(a=u.length;a>0;a-=1){f=u.slice(0,a).join("/"),i=r[f],c=n[f];if(c){isArray(c)&&(c=c[0]),u.splice(0,a,c);break}if(i){e===i.name?s=i.location+"/"+i.main:s=i.location,u.splice(0,a,s);break}}l=u.join("/"),l+=t||(/\?/.test(l)?"":".js"),l=(l.charAt(0)==="/"||l.match(/^[\w\+\.\-]+:/)?"":o.baseUrl)+l}return o.urlArgs?l+((l.indexOf("?")===-1?"?":"&")+o.urlArgs):l},load:function(e,t){req.load(r,e,t)},execCb:function(e,t,n,r){return t.apply(r,n)},onScriptLoad:function(e){if(e.type==="load"||readyRegExp.test((e.currentTarget||e.srcElement).readyState)){interactiveScript=null;var t=_(e);r.completeLoad(t.id)}},onScriptError:function(e){var t=_(e);if(!y(t.id))return S(makeError("scripterror","Script error",e,[t.id]))}}}function getInteractiveScript(){return interactiveScript&&interactiveScript.readyState==="interactive"?interactiveScript:(eachReverse(scripts(),function(e){if(e.readyState==="interactive")return interactiveScript=e}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.0.6",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/mg,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,ap=Array.prototype,aps=ap.slice,apsp=ap.splice,isBrowser=typeof window!="undefined"&&!!navigator&&!!document,isWebWorker=!isBrowser&&typeof importScripts!="undefined",readyRegExp=isBrowser&&navigator.platform==="PLAYSTATION 3"?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera=typeof opera!="undefined"&&opera.toString()==="[object Opera]",contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if(typeof define!="undefined")return;if(typeof requirejs!="undefined"){if(isFunction(requirejs))return;cfg=requirejs,requirejs=undefined}typeof require!="undefined"&&!isFunction(require)&&(cfg=require,require=undefined),req=requirejs=function(e,t,n,r){var i,s,o=defContextName;return!isArray(e)&&typeof e!="string"&&(s=e,isArray(t)?(e=t,t=n,n=r):e=[]),s&&s.context&&(o=s.context),i=contexts[o],i||(i=contexts[o]=req.s.newContext(o)),s&&i.configure(s),i.require(e,t,n)},req.config=function(e){return req(e)},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),addRequireMethods(req),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=function(e){throw e},req.load=function(e,t,n){var r=e&&e.config||{},i;if(isBrowser)return i=r.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script"),i.type=r.scriptType||"text/javascript",i.charset="utf-8",i.async=!0,i.setAttribute("data-requirecontext",e.contextName),i.setAttribute("data-requiremodule",t),i.attachEvent&&!(i.attachEvent.toString&&i.attachEvent.toString().indexOf("[native code")<0)&&!isOpera?(useInteractive=!0,i.attachEvent("onreadystatechange",e.onScriptLoad)):(i.addEventListener("load",e.onScriptLoad,!1),i.addEventListener("error",e.onScriptError,!1)),i.src=n,currentlyAddingScript=i,baseElement?head.insertBefore(i,baseElement):head.appendChild(i),currentlyAddingScript=null,i;isWebWorker&&(importScripts(n),e.completeLoad(t))},isBrowser&&eachReverse(scripts(),function(e){head||(head=e.parentNode),dataMain=e.getAttribute("data-main");if(dataMain)return cfg.baseUrl||(src=dataMain.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath,dataMain=mainScript),dataMain=dataMain.replace(jsSuffixRegExp,""),cfg.deps=cfg.deps?cfg.deps.concat(dataMain):[dataMain],!0}),define=function(e,t,n){var r,i;typeof e!="string"&&(n=t,t=e,e=null),isArray(t)||(n=t,t=[]),!t.length&&isFunction(n)&&n.length&&(n.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(e,n){t.push(n)}),t=(n.length===1?["require"]:["require","exports","module"]).concat(t)),useInteractive&&(r=currentlyAddingScript||getInteractiveScript(),r&&(e||(e=r.getAttribute("data-requiremodule")),i=contexts[r.getAttribute("data-requirecontext")])),(i?i.defQueue:globalDefQueue).push([e,t,n])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)})(this),tetra.extend("dep",function(e,t,n){return requirejs.config({baseUrl:e.APPS_PATH,enforceDefine:!0,urlArgs:e.jsVersion?"v="+e.jsVersion:"",paths:{g:e.GLOBAL_PATH,comp:e.COMP_PATH}}),{define:define,undef:requirejs.undef,require:require}}),tetra.extend("tmpl",function(e,t,n){(function(){var e={},t="<%",n="%>",r="%",i=new RegExp("'(?=[^"+r+"]*"+n+")","g"),s=new RegExp(t+"[=-](.+?)"+n,"g");this.tmpl=function o(u,a,f){f&&(t=f.left||t,n=f.right||n,r=f.right[0]||r,i=new RegExp("'(?=[^"+r+"]*"+n+")","g"),s=new RegExp(t+"[=-](.+?)"+n,"g"));try{var l=/\W/.test(u)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+u.replace(/[\r\t\n]/g," ").replace(i,"	").split("'").join("\\'").split("	").join("'").replace(s,"',$1,'").split(t).join("');").split(n).join("p.push('")+"');}return p.join('');"):e[u]=e[u]||o(document.getElementById(u).innerHTML);return a?l(a):l}catch(c){return typeof console!="undefined"&&console.error(c.message,c),""}}})();var r={left:"{%",right:"%}"};return _tmplStack={},_component=function(e,t,n,r){return function(i,s,o){s||(s={}),!o&&n&&(o=n);if(_tmplStack[e]){var u=o?"tmpl_"+o+"_"+i:"tmpl_"+i,a=r?r+"_"+_tmplStack[e].comp[r].countid++:u+"_"+_tmplStack[e].countid++;_tmplStack[e].comp[a]||(_tmplStack[e].count++,r&&_tmplStack[e].comp[r].count++,_tmplStack[e].comp[a]={id:u,data:s,count:0,countid:0,parentid:r,html:!1},o?tetra.controller.exec(i,o,s,undefined,t,e,a):tetra.controller.exec(i,s,undefined,t,e,a))}if(_tmplStack[e])return _tmplStack[e].comp[a].html}},_render=function(e,t,n,i){var s="";if(_tmplStack[e].count==0)_tmplStack[e].countid=0,s=tmpl(_tmplStack[e].id,_tmplStack[e].data,r),_tmplStack[e]&&(_tmplStack[e].cbk(s),delete _tmplStack[e]);else if(i){var o=_tmplStack[e].comp[t];o.html===!1&&o.count==0&&(_tmplStack[e].comp[t].countid=0,o.html=tmpl(o.id,o.data,r),_tmplStack[e].count--),o.html!==!1&&(o.parentid?_render(e,o.parentid,n,!0):_render(e,undefined,n,!1))}},function(e,t,n,i,s,o){var u=new Date,a=e.split("/"),f=/\W/.test(e.replace("/",""))?e:a.length==1?"tmpl_"+a[0]:"tmpl_"+a[0]+"_"+a[1],o=o?o:f,l=s&&_tmplStack[s].comp[o]&&_tmplStack[s].comp[o].html===!1,c="";if(document.getElementById(f)===null&&!/\W/.test(f))throw new Error("the HTML template '"+f+"' is missing in the DOM.");s||(s=o+"_"+u.getTime(),_tmplStack[s]={id:f,data:t,comp:{},count:0,countid:0,cbk:n}),t.component=_component(s,i,a[0],l?o:undefined),c=tmpl(f,t,r);if(_tmplStack[s]){if(l){var h=_tmplStack[s].comp[o];h.count==0&&(_tmplStack[s].comp[o].html=c,_tmplStack[s].comp[o].parentid&&_tmplStack[s].comp[_tmplStack[s].comp[o].parentid].count--,_tmplStack[s].count--)}_render(s,o,a.length==1?a[0]:undefined,l)}}}),tetra.extend("view",function(e,t,n){var r={},i={},s,o={},u={},a={change:["input","select"],submit:["form"],scroll:["div","textarea","ul"],select:["input"]},f={change:!0,submit:!0,select:!0},l={},c={},h=function(e){var t=document.createElement("div");e="on"+e;var n=e in t;return n||(t.setAttribute(e,"return;"),n=typeof t[e]=="function"),t=null,n},p=function(e,i,s){var u=e.type,a=!1,f;if(u==="click"&&e.button&&e.button===2)return;u==="focusin"?u="focus":u==="focusout"&&(u="blur"),s=typeof s=="undefined"?!0:!1,s||t.debug.log("view : call "+u+" listener","all","info"),f=o[u];if(typeof f!="undefined"&&f.length>0){var h=function(){},p,d,g;for(var y=0,b=f.length;y<b;y++){var w=f[y],E=r[w],S,T=!1;if(typeof E.root=="undefined"&&e.target.tagName!=="HTML"&&e.target.parentNode&&e.target.parentNode.tagName||i.parents("#"+E.root).length>0){S=E.events.user[u];for(var N in S)if(S.hasOwnProperty(N)){p=i,typeof p.is=="function"&&!p.is(N)&&typeof p.parents=="function"&&(p=p.parents(N),p=p.length>0?n(p[0]):!1);if(p)if(u!=="click"||typeof E.events.user.clickout=="undefined"||typeof E.events.user.clickout[N]=="undefined"||!!p.hasClass("cur-clickout")&&typeof c[w]!="undefined"&&typeof c[w][N]!="undefined")if(u==="mouseover"){n.toggleLib&&n.toggleLib(E.has_);if(p.hasClass("cur-mouseout")&&p.hasClass("cur-mouse-"+w.replace("/","-")))p=!1;else{for(g in l)l[g].view.events.user.mouseout[l[g].selector](l[g].event,l[g].view.has_?l[g].elm:l[g].elm[0]),l[g].elm.removeClass("cur-mouseout").removeClass("cur-mouse-"+l[g].viewName),delete l[g];typeof E.events.user.mouseout!="undefined"&&typeof E.events.user.mouseout[N]!="undefined"&&p.addClass("cur-mouseout").addClass("cur-mouse-"+w.replace("/","-"))}T=!0}else if(u==="mouseout"){var A=n.extend({},e);A.type=u,A.target=e.target,A.preventDefault=h,l[w+"/"+N]={view:E,viewName:w.replace("/","-"),event:A,elm:p,selector:N},p=!1}else u==="scroll"&&(i.is(N)||(p=!1));else{c[w]||(c[w]={}),c[w][N]?c[w][N]++:c[w][N]=1;var C={view:E,viewName:w,eventName:u,elm:p,selector:N},k="clickout-"+c[w][N],L=function(e){n.toggleLib&&n.toggleLib(C.view.has_);var r=n(e.target).is("."+k),i=n(e.target).parents("."+k).length>0;!r&&!i&&(t.debug.log("view "+C.viewName+" : call clickout callback on "+C.selector,C.view.scope,"info"),C.elm.removeClass("cur-clickout").removeClass(k),m(document,"click",L),C.view.events.user.clickout[C.selector](e,C.view.has_?C.elm:n(C.elm[0])[0]))};p.addClass("cur-clickout").addClass(k),v(document,"click",L)}p&&(i.hasClass("no-prevent")||i.parents(".no-prevent").length>0||(p.is("input")||p.is("textarea"))&&(u==="keydown"||p.attr("type")==="checkbox"||p.attr("type")==="radio")||e.preventDefault(),t.debug.log("view "+w+" : call "+u+" callback on "+N,E.scope,"info"),E.has_||(p=n(p[0])[0]),n.toggleLib&&n.toggleLib(E.has_),S[N](e,p),a=!0)}}if(u==="mouseover"&&!T&&i.parents(".cur-mouseout").length===0)for(g in l)l[g].view.events.user.mouseout[l[g].selector](l[g].event,l[g].view.has_?l[g].elm:l[g].elm[0]),l[g].elm.removeClass("cur-mouseout").removeClass("cur-mouse-"+l[g].viewName),delete l[g]}s&&!a&&x(e,i)}else s&&x(e,i)},d=function(e){if(e==="clickout")return"click";var t=!!document.addEventListener;return!t&&e==="focus"?"focusin":!t&&e==="blur"?"focusout":e},v=function(e,t,r){t=d(t),t==="focus"||t==="blur"?document.addEventListener(t,r,!0):n(e).bind(t,r)},m=function(e,t,r){t=d(t),t==="focus"||t==="blur"?document.removeEventListener(t,r,!0):n(e).unbind(t,r)},g=function(e){p(e,n(e.target))},y=function(r){r==="clickout"&&(r="click"),typeof o[r]=="undefined"&&(o[r]=[],typeof a[r]=="undefined"||typeof f[r]!="undefined"&&!!h(r)?v(document,r,g):e.domLoaded?b(r):n(document).ready(function(){b(r)}),t.debug.log("view : now listening "+r,"all","info"))},b=function(e,t){typeof t=="undefined"&&(t=n("body").find(a[e].join(",")));for(var r=0,i=t.length;r<i;r++)v(t[r],e,g)},w=function(e,t){typeof t=="undefined"&&(t=n("body").find(a[e].join(",")));for(var r=0,i=t.length;r<i;r++)m(t[r],e,g)},E=function(t,n){e.domLoaded&&typeof a[t]!="undefined"&&(typeof f[t]=="undefined"||!h(t))&&b(t,n)},S=e.bootnodeEvents,x=function(e,s){var o,u,a,f,l,c;e.type&&e.target.parentNode&&e.target.parentNode.tagName&&n.inArray(e.type.toLowerCase(),S)!==-1&&(o=s.hasClass("bootnode")?s:s.parents(".bootnode"),o.length>0&&(u=o.attr("data-view"),a=o.attr("data-comp"),l=e.type,c=n.extend({},e),c.type=l,c.preventDefault=function(){},typeof u!="undefined"?o.attr("data-event")===l&&typeof r[u]=="undefined"&&(e.preventDefault(),o.addClass("loading"),f=u.split("/"),t.dep.require([f[0]+"/view/"+f[1]+".ui"],function(){o.removeClass("loading"),p(c,s,!1)})):typeof a!="undefined"&&o.attr("data-event")===l&&typeof i[a]=="undefined"&&(i[a]=!0,o.addClass("loading"),t.dep.require(["comp/"+a],function(){o.removeClass("loading"),p(c,s,!1)}))))},T=function(){for(var e=0,t=S.length;e<t;e++)y(S[e])};s=function(e){return t.pipe.appBuilder("view",e)},s.retrieve=function(e,t){return r[e+"/"+t]},s.list=function(){var e={};for(var n in r)r.hasOwnProperty(n)&&(t.debug.log(r[n].scope+" / "+n),typeof e[r[n].scope]=="undefined"&&(e[r[n].scope]=[]),e[r[n].scope].push(n));return e},s.msg=function(e){var n=[],i=r[e].events.controller;for(var s in i)i.hasOwnProperty(s)&&(t.debug.log(s),n.push(s));return n},s.man=function(){return t.debug.log("Tetra.js ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"),t.debug.log("> View specs:"),t.debug.log("		- notify app views as a controller		> tetra.debug.view(scope).notify(message, data)"),t.debug.log("		- list all views and their scope		> tetra.debug.view.list()"),t.debug.log("		- list all controller messages listened > tetra.debug.view.msg(viewName)"),t.debug.log("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"),!0};var N=function(e){var r=this,i=e.constr.length>2;n.toggleLib&&n.toggleLib(i);var s=t.pipe.appBuilder("controller",e.scope),o=e.constr(this,s,n);return this.has_=i,this.scope=e.scope,this.root=e.root,this.events=o.events,this.methods=o.methods,this.listen=E,this},C=function(n,i){r[n]=new N(i),t.debug.log("view "+n+" : registered",r[n].scope,"info");var s;if(r[n].events.user){var a=r[n].events.user;for(s in a)a.hasOwnProperty(s)&&(y(s,n),t.debug.log("view "+n+" : listening "+s,r[n].scope,"info"),s!=="clickout"&&o[s].push(n))}if(r[n].events.window){var f=r[n].events.window;for(s in f)f.hasOwnProperty(s)&&(typeof u[s]=="undefined"&&(u[s]=[]),v(window,s,f[s]),t.debug.log("view "+n+" : listening "+s,r[n].scope,"info"),u[s].push(n))}return typeof r[n].methods!="undefined"&&typeof r[n].methods.init!="undefined"&&(!e.hasOwnProperty("disableViewInit")||!e.disableViewInit)&&r[n].methods.init(),r[n]};return e.env!=="Node"&&n(document).ready(function(){e.domLoaded=!0}),e.enableBootnode&&T(),{register:function(e,n){var i=n.scope+"/"+e;if(!e||!n)throw new Error("tetra.view.register(name, params) : name and params are both required arguments");if(!n.hasOwnProperty("scope")||!n.hasOwnProperty("constr"))throw new Error("tetra.view.register(name, params) : params must define a scope attribute and a constr method");if(r[i])throw new Error("A view with the scope/name "+i+" already exists");var s=[];if(typeof n.use!="undefined")for(var o=0,u=n.use.length;o<u;o++)s.push(n.scope+"/controller/"+n.use[o]+".ctrl");t.dep.define(n.scope+"/view/"+e+".ui",s,function(e){C(i,n)}),t.dep.require([n.scope+"/view/"+e+".ui"])},destroy:function(e,n){var i=n+"/"+e,s,l,c,p;for(var d in o)if(o.hasOwnProperty(d)){s=o[d],l=!0,typeof a[d]!="undefined"&&(typeof f[d]=="undefined"||!h(d))&&(l=!1);for(c=0,p=s.length;c<p;c++)s[c]===i&&(l||w(d),s.splice(c,1));!l&&o[d].length===0&&delete o[d]}for(d in u)if(u.hasOwnProperty(d)){s=u[d];for(c=0,p=s.length;c<p;c++)s[c]===i&&(m(window,d,r[i].events.window[d]),s.splice(c,1))}t.dep.undef(n+"/view/"+e+".ui"),delete r[i]},notify:function(e,i,s){var o,u,a;for(var f in r)r.hasOwnProperty(f)&&(o=r[f],u=o.scope,o.events.controller&&(a=o.events.controller,u===s&&typeof a!="undefined"&&typeof a[e]!="undefined"&&(t.debug.log("view "+f+" : exec "+e,s,"info"),n.toggleLib&&n.toggleLib(o.has_),a[e](i,t.pipe.appBuilder("controller",s)))))},debug:s}}),tetra.extend("controller",function(e,t,n){var r={},i={},s;s={page:t.pipe.page,app:function(e){return t.pipe.appBuilder("controller",e)},list:function(){var e={};for(var n in r)r.hasOwnProperty(n)&&(t.debug.log(r[n].scope+" / "+n),typeof e[r[n].scope]=="undefined"&&(e[r[n].scope]=[]),e[r[n].scope].push(n));return e},retrieve:function(e,t){var n=r[e+"/"+t];return n&&(n.actions=i[e+"/"+t]),n},msg:function(e){var n=[],i;if(r[e]&&r[e].events.view){i=r[e].events.view;for(var s in i)i.hasOwnProperty(s)&&(t.debug.log(s),n.push(s))}else t.debug.log(e+" was not found");return n},man:function(){return t.debug.log("Tetra.js ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"),t.debug.log("> Controller specs:"),t.debug.log("		- notify app controllers as a view		> tetra.debug.ctrl.app(scope).notify(message, data)"),t.debug.log("		- notify all as a controller			> tetra.debug.ctrl.page.notify(message, data)"),t.debug.log("		- list all controllers with their scope	> tetra.debug.ctrl.list()"),t.debug.log("		- list all view messages listened		> tetra.debug.ctrl.msg(ctrlName)"),t.debug.log("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"),!0}};var o=function(e,n){var r=this,s=t.pipe.appBuilder("view",n.scope),o=n.constr(r,s,t.pipe.page,t.orm(n.scope));return this.scope=n.scope,this.events=o.events,this.methods=o.methods,i[e]=o.actions,this},u=function(e,n){return r[e]=new o(e,n),t.debug.log("controller "+e+" : registered",r[e].scope,"info"),typeof r[e].methods!="undefined"&&typeof r[e].methods.init!="undefined"&&r[e].methods.init(),r[e]};return{register:function(n,i){e.env==="Node"&&(i.scope="node");var s=i.scope+"/"+n;if(!n||!i)throw new Error("tetra.controller.register(name, params) : name and params are both required arguments");if(!i.hasOwnProperty("scope")||!i.hasOwnProperty("constr"))throw new Error("tetra.controller.register(name, params) : params must define a scope attribute and a constr method");if(r[s])throw new Error("A controller with the scope/name "+s+" already exists");var o=[],a;if(typeof i.use!="undefined")for(var f=0,l=i.use.length;f<l;f++)a=i.use[f],a.substring(0,2)==="g/"?(a=a.substring(2),o.push("g/model/"+a+".class")):o.push(i.scope+"/model/"+a+".class");t.dep.define(i.scope+"/controller/"+n+".ctrl",o,function(){u(s,i)}),t.dep.require([i.scope+"/controller/"+n+".ctrl"])},destroy:function(e,n){var i=n+"/"+e;t.dep.undef(n+"/controller/"+e+".ctrl"),delete r[i]},notify:function(e,n,i){i=i||"all";var s,o,u;for(var a in r)if(r.hasOwnProperty(a)){s=r[a],o=s.scope;if(i!=="all"&&s.events.view||s.events.controller)u=i!=="all"?s.events.view:s.events.controller,(i==="all"||i===o)&&typeof u[e]!="undefined"&&(t.debug.log("ctrl "+a+" : exec "+e,i,"info"),u[e](n))}},modelNotify:function(e,n,i){var s;for(var o in r)r.hasOwnProperty(o)&&(s=r[o],s.events&&typeof s.events.model!="undefined"&&typeof s.events.model[e]!="undefined"&&(t.debug.log("ctrl "+o+" : model "+e+" "+n,s.scope,"info"),typeof s.events.model[e][n]!="undefined"&&s.events.model[e][n].apply(s,i)))},exec:function(e,n,r,s,o,u,a){var f;if(typeof n!="string")a=u,u=o,o=s,s=r,r=n,n=undefined,f=e;else{var l=o+"/"+n;f=n+"/"+e}var c=function(e,n){n||(n=f),t.tmpl(n,e,s,o,u,a)},h=function(){l&&i[l]&&i[l][e]?i[l][e](r,c):c(r)};n?t.dep.require([o+"/controller/"+n+".ctrl"],h):h()},debug:s}}),tetra.extend("model",function(e,t,n){var r={},i={},s;tetra.extend("orm",function(e,t,n){if(typeof t.cache!="undefined")var s=t.cache;e.api?n.initApi(e.api):e.mysql&&n.initMysql(e.mysql);var o=function(e){return e=n.trim(e),!e||e.length===0?!1:/^[\],:{}\s]*$/.test(e.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))},u=function(e){return function(t){typeof t=="string"&&o(t)&&(t=JSON.parse(t)),e(t)}},a=function(e,t){return function(n){var r;o(n.responseText)&&(r=JSON.parse(n.responseText)),e(n.status,r?r:{}),(n.status===401||n.status===403)&&t(n)}},f=function(){var t=[],r=!1,i=function(){!r&&t.length>0&&(f.request(t[0].src,t[0].url,t[0].options),t.shift())};return{queue:function(n,r,s){e.env==="Node"?f.request(n,r,s):(t.push({src:n,url:r,options:s}),i())},request:function(t,s,o){n.toggleLib&&n.toggleLib(!0);var l={};return r=!0,tetra.currentRequest=function(){f.queue(t,s,o),e.currentRequestCallback&&e.currentRequestCallback()},e.env==="Node"&&e.api&&e.api.access_token?l={data:{access_token:e.api.access_token}}:l={processData:o.headers["Content-Type"]&&o.headers["Content-Type"].indexOf("application/json")===0?!1:!0,create:function(e){t.model.notify("call")({req:e,obj:t.obj?t.obj:{}})},complete:function(e){t.model.notify("complete")({req:e,obj:t.obj?t.obj:{}}),r=!1,i()}},typeof e.authCallback!="undefined"&&(l.error401=e.authCallback),l.success=u(o.success),l.error=a(o.error,l.error401),t.model.type==="ajax"?n.ajax(s,n.extend(o,l)):t.model.type==="api"?n.api(s,n.extend(o,l)):t.model.type==="mysql"?n.mysql(s,n.extend(o,l)):!1}}}();return function(o){return function(u){var a=r[o+"/"+u]||r["g/"+u],l=function(n,r,f){var l=i[o+"/"+u]||i["g/"+u],c=new l;c.update(n,r),a.objects[c.get("ref")]=c;if(c.get("id")!==0&&c.get("id")!="0020"){a.ids[c.get("id")]=c.get("ref");if(s&&(typeof f=="undefined"||typeof f!="undefined"&&!f)){var h="NODE:"+o+"-"+u+"-id-"+c.get("id");s.set(h,n,e.cacheTimeout,function(r,i){e.env==="Node"&&t.debug.log('ORM: SAVE: store "'+h+'"',"all","log",n)})}}return t.debug.log("model "+o+"/"+u+" : object "+c.get("ref")+" created","all","info"),b("create")(c),c},c=function(n){var r=n.id,i=a.objects[n.ref];b("save")(i),f.queue({model:this,obj:i},x(a.req.save,n),{type:a.req.save.method,headers:a.req.save.headers,data:T(a.req.save,n),success:function(f){f=f||{},typeof f=="string"&&(f={status:"SUCCESS",data:{0:{html:f}}});if(f.status==="FAIL")b("alert")({type:"save",alerts:f.alerts?f.alerts:{},obj:i},f);else{if(typeof f.data!="undefined"){for(var l in f.data)break;if(typeof l!="undefined"){if(r===0||r==="0020"){a.cache={},i.set("id",l),a.ids[i.get("id")]=i.get("ref");if(s){n.id=l;var c="NODE:"+o+"-"+u+"-id-"+i.get("id");s.set(c,n,e.cacheTimeout,function(r,i){e.env==="Node"&&t.debug.log('ORM: SAVE: store "'+c+'"',"all","log",n)})}}i.update(f.data[l])}}b("saved")(i,f)}},error:function(e,t){b("error")({type:"save",errorCode:e,errors:t.errors?t.errors:[],obj:i},t),i.revert()}})},h=function(n,r,i){b("fetch")(n);var c=n.uriParams;f.queue({model:i?i:this},x(a.req.fetch,n),{type:a.req.fetch.method,headers:a.req.fetch.headers,data:T(a.req.fetch,n),success:function(i){if(i&&(!i.status||i.status!=="FAIL")){var f=[],h=[],p;if(typeof a.req.fetch.parser!="undefined")c&&(n.uriParams=c),p=a.req.fetch.parser(i,{},n),i={data:p,count:i&&i.count?i.count:0};else if(a.req.type==="mysql"){var d=0;p={};for(;d<i.length;d++)p[i[d][a.req.dbTable.id]]=i[d];i={data:p}}for(var v in i.data)i.data.hasOwnProperty(v)&&(f.push(v),i.data[v].id=v,h.push(l(i.data[v])));e.env==="Node"&&delete n.access_token,n.uriParams=c;var m=JSON.stringify(n);e.env==="Node"&&t.debug.log("ORM: FETCH "+o+"/"+u+" with cond: "+m,"all","log");if(s){var g="NODE:"+o+"-"+u+"-req-"+m;s.set(g,f,e.cacheTimeout,function(n,r){e.env==="Node"&&t.debug.log('ORM: FETCH: store "'+g+'"',"all","log",f)})}else a.cache[m]=f;if(typeof i!="string")for(var y in i)i.hasOwnProperty(y)&&y!=="status"&&y!=="data"&&y!=="alerts"&&y!=="errors"&&(a.meta[y]=i[y]);typeof r!="undefined"?r(h):b("append")(h)}else n.uriParams=c,b("alert")({type:"fetch",alerts:i&&i.alerts?i.alerts:{},cond:n},i)},error:function(e,t){n.uriParams=c,b("error")({type:"fetch",errorCode:e,errors:t&&t.errors?t.errors:[],cond:n},t)}})},p=function(e,t){if(typeof a.ids[e]=="undefined"){var n=this;h({id:e},t?function(e){t(e[0])}:undefined,n)}else t(a.objects[a.ids[e]])},d=function(e,t){t(a.objects[e]||null)},v=function(e,t){var n=[],r=a.objects,i;for(var s in r)if(r.hasOwnProperty(s)){i=!0;for(var o in e)if(e.hasOwnProperty(o)&&r[s].get(o)!=e[o]){i=!1;break}i&&n.push(r[s])}n.length<=1?t(n[0]||null):t(n)},m=function(n,r){if(n.uriParams){var i=n.uriParams;delete n.uriParams,n.uriParams=i}var f=JSON.stringify(n);e.env==="Node"&&t.debug.log("ORM: SELECT "+o+"/"+u+" with cond: "+f,"all","log");if(s){var l="NODE:"+o+"-"+u+"-req-"+f;s.get(l,function(i,s){e.env==="Node"&&t.debug.log('ORM: SELECT: retrieve "'+l+'"',"all","log",s),g(n,s,r,this)})}else g(n,a.cache[f],r,this)},g=function(n,r,i,f){if(!r)e.env==="Node"&&t.debug.log("ORM: SELECT: data retrieved from server","all","log"),h(n,i?function(e){i(e)}:undefined,f);else{e.env==="Node"&&t.debug.log("ORM: SELECT: data retrieved from cache:","all","log",r);var c=[],p=0,d=r.length,v=[];if(d===0||!s){for(p=0;p<d;p++)c.push(a.objects[a.ids[r[p]]]);i?i(c):b("append")(c)}else{for(p=0;p<d;p++)v.push("NODE:"+o+"-"+u+"-id-"+r[p]);s.get(v,function(e,t){var n=[],r;for(r in t)n.push(l(t[r],!1,!0));i?i(n):b("append")(n)})}}},y=function(n,r){var i=a.objects[n];b("delete")(i),typeof r=="undefined"&&(r={id:i.get("id")}),f.queue({model:this},x(a.req.del,r),{type:a.req.del.method,headers:a.req.del.headers,data:T(a.req.del,r),success:function(r){r=r||{};if(r.status==="SUCCESS"||typeof r.status=="undefined"){b("deleted")(i,r),delete a.ids[i.get("id")],delete a.objects[n];if(s){var f="NODE:"+o+"-"+u+"-id-"+i.get("id");s.del(f,function(n,r){e.env==="Node"&&t.debug.log('ORM: DEL: delete "'+f+'"',"all","log",r)})}}else b("alert")({type:"delete",alerts:r.alerts?r.alerts:{},obj:i},r)},error:function(e,t){b("error")({type:"delete",errorCode:e,errors:t.errors?t.errors:[],obj:i},t),delete a.ids[i.get("id")],delete a.objects[n]}})},b=function(e){return function(){t.debug.log("model "+o+"/"+u+" : "+e,"all","log",arguments[0]),tetra.controller.modelNotify(u,e,arguments)}},w=function(e){b("reset")(a.objects),a.ids={},a.objects={},f.queue({model:this},x(a.req.reset,e),{type:a.req.reset.method,headers:a.req.reset.headers,data:T(a.req.reset,e),success:function(e){e=e||{},e.status&&e.status==="FAIL"?b("alert")({type:"reset",alerts:e.alerts?e.alerts:{}},e):b("resetted")(u,e)},error:function(t,n){b("error")({type:"reset",errorCode:t,errors:n.errors?n.errors:[],data:e},n)}})},E=function(){var e=0,t=a.objects;for(var n in t)t.hasOwnProperty(n)&&e++;return e},S=function(e){return a.meta[e]},x=function(e,t,n){var r=e.url,i;if(a.req.type==="mysql")return a.req.dbTable;if(typeof e.uriParams!="undefined"){for(var s=0,o=e.uriParams.length;s<o;s++)typeof t[e.uriParams[s]]!="undefined"?r=r.replace("{"+s+"}",t[e.uriParams[s]]):r=r.replace("{"+s+"}",t.uriParams[e.uriParams[s]]);typeof t.uriParams!="undefined"&&delete t.uriParams}return n||(i=new Date,r.indexOf("?")<0?r+="?ts="+i.getTime():r+="&ts="+i.getTime()),r},T=function(e,t){return e.headers["Content-Type"]&&e.headers["Content-Type"].indexOf("application/json")===0?JSON.stringify(n.extend(t,e.params)):n.extend(t,e.params)};return{type:a.req.type,create:function(e){return l(e,!0)},save:c,fetch:h,find:p,findByRef:d,findByCond:v,select:m,del:y,reset:w,notify:b,length:function(){return E()}(),getMeta:S}}}}),s=function(e,n){return t.orm(e)(n)},s.list=function(){var e=[],n;for(n in r)r.hasOwnProperty(n)&&(t.debug.log(n),e.push(n));return e},s.retrieve=function(e,t){return r[e+"/"+t]},s.man=function(){return t.debug.log("Tetra.js ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"),t.debug.log("> Model specs:"),t.debug.log("		- retrieve an object and its ref		> tetra.debug.model(modelName).findByRef(ref)"),t.debug.log("		- notify all controllers as a model		> tetra.debug.model(modelName).notify(type)(data)"),t.debug.log("			  * types : call, complete, create, fetch, append, save, saved, delete, deleted, reset, resetted, error"),t.debug.log("		- list all models						> tetra.debug.model.list()"),t.debug.log("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"),!0};var o=function(e,r){var i=e,s=r.scope,o=r.attr,u=r.methods;return function(){var e=n.extend({ref:0,id:0},o),r={};for(var a in e)e.hasOwnProperty(a)&&(r[a]=e[a]);var f=n.extend({get:function(t){return e[t]},getAll:function(){return e},set:function(t,n){return r[t]=e[t],typeof e[t]!="undefined"&&(e[t]=n),this},update:function(e,t){if(t||c(e,this)){for(var n in e)this.set(n,e[n]);return this}return{save:function(){}}},revert:function(){e=r},save:function(r){return c(e,this)?(t.orm(s)(i).save(n.extend(e,r)),e.id):!1},remove:function(r){t.orm(s)(i).del(e.ref,n.extend(e,r))}},u(e)),l=function(){e.ref=(new Date).getTime()+"-"+Math.ceil(Math.random()*1001),f.ref=e.ref},c=function(t,n){var r=[];if(typeof f.validate!="undefined"){var s={};for(var o in e)e.hasOwnProperty(o)&&(typeof t[o]!="undefined"?s[o]=t[o]:s[o]=e[o]);r=f.validate(s,r);if(r.length>0)return tetra.controller.modelNotify(i,"invalid",[{attr:r,obj:n}]),!1}return!0};return l(),typeof f.init=="function"&&f.init(),f}},u=function(t,r){typeof r.req=="undefined"&&(r.req={});var i=n.extend({objects:{},ids:{},cache:{},meta:{}},r);typeof i.req.type=="undefined"&&(i.req.type="ajax"),i.req.fetch=n.extend({url:e.FETCH_URL.replace("{name}",t),method:e.FETCH_METHOD,headers:{},params:{}},r.req.fetch),i.req.save=n.extend({url:e.SAVE_URL.replace("{name}",t),method:e.SAVE_METHOD,headers:{},params:{}},r.req.save),i.req.del=n.extend({url:e.DEL_URL.replace("{name}",t),method:e.DEL_METHOD,headers:{},params:{}},r.req.del),i.req.reset=n.extend({url:e.RESET_URL.replace("{name}",t),method:e.RESET_METHOD,headers:{},params:{}},r.req.reset);for(var s in i.req)if(i.req.hasOwnProperty(s)){var o=i.req[s];o.hasOwnProperty("headers")&&(o.headers["Content-type"]&&(o.headers["Content-Type"]=o.headers["Content-type"],delete o.headers["Content-type"]),o.headers["Content-Type"]&&!/charset/.test(o.headers["Content-Type"])&&(o.headers["Content-Type"]=o.headers["Content-Type"]+";charset=utf-8"),o.headers.Accept||(o.headers.Accept="*/*"))}var u=r.req.save.method.toUpperCase();if(u!=="POST"&&u!=="PUT")throw new Error("A 'save' can only be performed using POST or PUT");var a=r.req.del.method.toUpperCase();if(a!=="POST"&&a!=="DELETE")throw new Error("A 'delete' can only be performed using POST or DELETE");var f=r.req.reset.method.toUpperCase();if(f!=="PUT"&&f!=="POST")throw new Error("A 'reset' can only be performed using PUT or POST");return i};return{register:function(n,s){s=s||{},e.env==="Node"&&(s.scope="node"),s.scope||(s.scope="g");var a=s.scope+"/"+n;if(!n)throw new Error("tetra.model.register(name, params) : Name is a required argument");if(r[a]||r["g/"+n])throw new Error("A model with the name "+n+" already exists");t.dep.define(s.scope+"/model/"+n+".class",function(){return r[a]=u(n,s),t.debug.log("model "+a+" : registered","all","info"),i[a]=new o(n,s),t.debug.log("model "+a+" : associated class generated","all","info"),r[a]}),t.dep.require([s.scope+"/model/"+n+".class"])},destroy:function(e,n){n||(n="g");var i=n+"/"+e;t.dep.undef(n+"/model/"+e+".class"),delete r[i]},debug:s}});